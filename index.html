<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>美妝私教問卷 v202506161500</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #f8f9fa 0%, #f5e6ff 100%);
      min-height: 100vh;
    }

    .custom-card {
      background-color: #ffffff;
      border: 2px solid #000;
    }

    textarea {
      min-height: 80px;
    }

    @media (max-width: 768px) {
      .form-label {
        font-size: 1rem;
      }
      .card-header h4 {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
<div class="container my-5 px-3">
  <div class="card shadow-lg custom-card">
    <div class="card-header bg-black text-white">
      <h4 class="mb-0">美妝私教客戶問卷調查表</h4>
    </div>
    <div class="card-body">
      <form id="beautyForm">
        <div class="row">
          <!-- 左側 1/4 -->
          <div class="col-md-3 border-end mb-4 mb-md-0">
            <div class="mb-3">
              <label class="form-label fw-bold">喜歡的穿衣風格</label>
              <textarea class="form-control" name="fashion_style" placeholder="例：甜美、韓系、極簡"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">喜歡的拍照風格</label>
              <textarea class="form-control" name="photo_style" placeholder="例：日系、藝術感、生活感"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">介紹人</label>
              <textarea class="form-control" name="referrer" placeholder=""></textarea>
            </div>
          </div>
          <!-- 右側 3/4 -->
          <div class="col-md-9">
            <!-- 問題 1 -->
            <div class="mb-4">
              <label class="form-label fw-bold">1. 覺得自己整體妝面中最大的問題是？(可複選)</label>
              <div class="row">
                <div class="col-sm-6 col-md-4">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="makeup1" name="makeup_problem[]" value="底妝"><label class="form-check-label" for="makeup1">底妝</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="makeup2" name="makeup_problem[]" value="修容"><label class="form-check-label" for="makeup2">修容</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="makeup3" name="makeup_problem[]" value="眼妝"><label class="form-check-label" for="makeup3">眼妝</label></div>
                </div>
                <div class="col-sm-6 col-md-4">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="makeup4" name="makeup_problem[]" value="眉毛"><label class="form-check-label" for="makeup4">眉毛</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="makeup5" name="makeup_problem[]" value="腮紅"><label class="form-check-label" for="makeup5">腮紅</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="makeup6" name="makeup_problem[]" value="唇妝"><label class="form-check-label" for="makeup6">唇妝</label></div>
                </div>
              </div>
            </div>
            <!-- 問題 2 -->
            <div class="mb-4">
              <label class="form-label fw-bold">2. 以下步驟中分別遇到的問題是？(可複選)</label>

              <p class="mb-1">底妝</p>
              <div class="row mb-2">
                <div class="col-md-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="base1" name="base_problems[]" value="底妝-問題1"><label class="form-check-label" for="base1">問題1</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="base2" name="base_problems[]" value="底妝-問題2"><label class="form-check-label" for="base2">問題2</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="base3" name="base_problems[]" value="底妝-問題3"><label class="form-check-label" for="base3">問題3</label></div>
                </div>
                <div class="col-md-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="base4" name="base_problems[]" value="底妝-問題4"><label class="form-check-label" for="base4">問題4</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="base5" name="base_problems[]" value="底妝-問題5"><label class="form-check-label" for="base5">問題5</label></div>
                </div>
              </div>
              <p class="mb-1">修容</p>
              <div class="row">
                <div class="col-md-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="contour1" name="contour_problems[]" value="修容-問題1"><label class="form-check-label" for="contour1">問題1</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="contour2" name="contour_problems[]" value="修容-問題2"><label class="form-check-label" for="contour2">問題2</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="contour3" name="contour_problems[]" value="修容-問題3"><label class="form-check-label" for="contour3">問題3</label></div>
                </div>
                <div class="col-md-6">
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="contour4" name="contour_problems[]" value="修容-問題4"><label class="form-check-label" for="contour4">問題4</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" id="contour5" name="contour_problems[]" value="修容-問題5"><label class="form-check-label" for="contour5">問題5</label></div>
                </div>
              </div>
            </div>
            <!-- 問題 3 -->
            <div class="mb-4">
              <label class="form-label fw-bold">3. 選擇來美妝學習的原因是？(可複選)</label>
              <div class="form-check"><input class="form-check-input" type="checkbox" id="reason1" name="learning_reasons[]" value="原因1"><label class="form-check-label" for="reason1">原因1</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" id="reason2" name="learning_reasons[]" value="原因2"><label class="form-check-label" for="reason2">原因2</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" id="reason3" name="learning_reasons[]" value="原因3"><label class="form-check-label" for="reason3">原因3</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" id="reason4" name="learning_reasons[]" value="原因4"><label class="form-check-label" for="reason4">原因4</label></div>
              <div class="form-check"><input class="form-check-input" type="checkbox" id="reason5" name="learning_reasons[]" value="原因5"><label class="form-check-label" for="reason5">原因5</label></div>
              <div class="form-check mt-2"><input class="form-check-input" type="checkbox" id="reasonOther" name="learning_reasons[]" value="其他"><label class="form-check-label" for="reasonOther">其他</label></div>
              <textarea class="form-control mt-2" name="other_reason" placeholder="請填寫其他原因"></textarea>
            </div>
          </div>
        </div>
        <div class="text-end mt-4">
          <button type="submit" class="btn btn-primary px-4 py-2">提交問卷</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  document.getElementById("beautyForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    // ✅ 驗證開始
    const isMakeupChecked = hasAtLeastOneChecked("makeup_problem[]");
    const isBaseChecked = hasAtLeastOneChecked("base_problems[]");
    const isContourChecked = hasAtLeastOneChecked("contour_problems[]");
    const isReasonChecked = hasAtLeastOneChecked("learning_reasons[]");
    if (!isMakeupChecked && !isBaseChecked && !isContourChecked && !isReasonChecked) {
      Swal.fire({
        icon: "warning",
        title: "請填寫至少一個問題",
        text: "除了風格與介紹人外，請至少選擇一個複選欄位！"
      });
      return;
    }
    // ✅ 驗證函式
    function hasAtLeastOneChecked(name) {
      return [...document.querySelectorAll(`input[name="${name}"]`)].some(input => input.checked);
    }

    // ✅ 實際送出邏輯
    const form = e.target;
    const formData = new FormData(form);
    const params = new URLSearchParams();
    for (const [key, value] of formData.entries()) {
      params.append(key, value);
    }
    Swal.fire({
      title: "提交中...",
      text: "請稍候",
      allowOutsideClick: false,
      allowEscapeKey: false,
      didOpen: () => Swal.showLoading()
    });
    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbxH88v0wj7RioZAToyp98e7MJwxU8i-26gryisFr-pmrqNm8csOAOwYPs596feL1bwV/exec", {
        method: "POST",
        body: params,
      });
      const data = await response.json();
      Swal.fire({
        title: data.status === "success" ? "送出成功" : "錯誤",
        text: data.message,
        icon: data.status === "success" ? "success" : "error",
      });
      if (data.status === "success") form.reset();
    } catch (error) {
      Swal.fire({
        title: "送出失敗",
        text: "請稍後再試或聯繫管理員。",
        icon: "error"
      });
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
